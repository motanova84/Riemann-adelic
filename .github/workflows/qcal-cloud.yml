name: QCAL Validation Node

on: [push]

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      - name: Run validation
        run: python validate_v5_coronacion.py --precision 25
      - name: Upload results
        env:
          QCAL_API: https://qcal.cloud
        run: |
          python - <<'PY'
import json
import os
import pathlib
import requests

result = pathlib.Path("validation.json")
if not result.exists():
    result.write_text(json.dumps({"status": "missing", "note": "Placeholder payload"}))

api = os.environ.get("QCAL_API", "http://localhost:8000")
response = requests.post(f"{api}/api/upload", json=json.loads(result.read_text()))
response.raise_for_status()
print("Uploaded certificate", response.json())
PY
